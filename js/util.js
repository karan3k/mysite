var isValidDate=function(d){return d instanceof Date&&!isNaN(d)},isSameDay=function(date1,date2){return date1.getFullYear()==date2.getFullYear()&&date1.getMonth()==date2.getMonth()&&date1.getDate()==date2.getDate()},getParams=function(url){var params={},parser=document.createElement("a");parser.href=url;for(var query,vars=parser.search.substring(1).split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");params[pair[0]]=decodeURIComponent(pair[1])}return params},days_iterator=function*(data){for(ev of(cur_date=null,day_arr=[],data))date=new Date(ev.Date),isValidDate(date)&&(null==cur_date?cur_date=date:data.indexOf(ev)==data.length-1?(day_arr.push(ev),yield day_arr):isSameDay(cur_date,date)?day_arr.push(ev):(yield day_arr,cur_date=date,day_arr=[]))},deepClone=function(obj,hash=new WeakMap){if(Object(obj)!==obj)return obj;if(obj instanceof Set)return new Set(obj);if(hash.has(obj))return hash.get(obj);const result=obj instanceof Date?new Date(obj):obj instanceof RegExp?new RegExp(obj.source,obj.flags):obj.constructor?new obj.constructor:Object.create(null);return hash.set(obj,result),obj instanceof Map&&Array.from(obj,([key,val])=>result.set(key,this.deepClone(val,hash))),Object.assign(result,...Object.keys(obj).map(key=>({[key]:this.deepClone(obj[key],hash)})))},get_glucose_level=function(val){return""==val||null==val||isNaN(val)?"unknown":val<54?"very_low":val<70?"low":val<180?"normal":val<250?"high":"very_high"},calc_day_diff=function(date1,date2){var diff=Math.floor(Math.abs(new Date(date2).getTime()-new Date(date1).getTime())),day=864e5;return Math.floor(diff/day)},invert_order_of_data=function(data){for(var tmp=[],i=data.length-1;i>=0;i--)tmp.push(data[i]);return tmp},select_days=function(data,numdays){for(i in result=[],data=data.filter(d=>""!=d.Date&&null!=d.Date),start_date=data[0].Date.split(" ")[0],data)if(cur_date=data[i].Date.split(" ")[0],!(calc_day_diff(start_date,cur_date)<startDayNum)){if(calc_day_diff(start_date,cur_date)>=startDayNum+numDays)break;result.push(data[i])}return result},averageRGB=function(){var reSegment=/[\da-z]{2}/gi;function dec2hex(v){return v.toString(16)}function hex2dec(v){return parseInt(v,16)}return function(c1,c2){if(null==c1)return c2;if(null==c2)return c1;for(var b1=c1.match(reSegment),b2=c2.match(reSegment),t,c=[],i=b1.length;i;)t=dec2hex(hex2dec(b1[--i])+hex2dec(b2[i])>>1),c[i]=2==t.length?""+t:"0"+t;return"#"+c.join("")}}(),get_color=function(level){switch(level){case"unknown":return opt.colorscheme[0];case"very_high":return opt.colorscheme[1];case"high":return opt.colorscheme[2];case"normal":return opt.colorscheme[3];case"low":return opt.colorscheme[4];case"very_low":return opt.colorscheme[5];default:return opt.colorscheme[6]}},groupBy=function(xs,key){return xs.reduce((function(rv,x){return(rv[x[key]]=rv[x[key]]||[]).push(x),rv}),{})},find_unique_targets=function(link_collection){for(link of(res=[],link_collection))-1==res.indexOf(link.target)&&res.push(link.target);return res},find_unique_sources=function(link_collection){for(link of(res=[],link_collection))-1==res.indexOf(link.source)&&res.push(link.source);return res},create_gradient=function(d,i){defs=svg.select("defs");const gradientID=`gradient${i}`,startColor=d.source.color,stopColor=d.target.color;var startPercent="10%",endPercent="90%";d.target==window.graph.sink?(startPercent="0%",endPercent="100%"):d.source==window.graph.source&&(startPercent="0%",endPercent="100%");const linearGradient=defs.append("linearGradient").attr("id",gradientID);return linearGradient.selectAll("stop").data([{offset:startPercent,color:startColor},{offset:endPercent,color:stopColor}]).enter().append("stop").attr("offset",d=>d.offset).attr("stop-color",d=>d.color),`url(#${gradientID})`},create_transparent_black_gradients=function(){var t_to_b_gradient,b_to_t_gradient;defs=svg.select("defs"),defs.append("linearGradient").attr("id","transparent_to_black_gradient").selectAll("stop").data([{offset:0,color:"#ffffff00"},{offset:1,color:"#000"}]).enter().append("stop").attr("offset",d=>d.offset).attr("stop-color",d=>d.color),defs.append("linearGradient").attr("id","black_to_transparent_gradient").selectAll("stop").data([{offset:0,color:"#000"},{offset:1,color:"#ffffff00"}]).enter().append("stop").attr("offset",d=>d.offset).attr("stop-color",d=>d.color)},draw_grid=function(path){for(var lineGen=d3.line().x((function(d){return d.x})).y((function(d){return d.y})),start_x_off=200,space_in,x_off=200-(space_in=(width-200)/(4*(path.length+1)))/2,i=0;i<4*path.length;i++)svg.append("path").attr("stroke",()=>i%4==0||(i-1)%4==0?"#777":"#ccc").attr("stroke-width","1").style("stroke-dasharray","3, 3").attr("d",lineGen([{x:x_off+i*space_in,y:0},{x:x_off+i*space_in,y:height}]));for(var start_y_off=200,space_in,y_off=200-(space_in=(height-200)/(2*(glucose_levels.length+1)))/2,i=0;i<2*glucose_levels.length;i++)svg.append("path").attr("stroke","#ccc").attr("stroke-width","1").style("stroke-dasharray","3, 3").attr("d",lineGen([{x:0,y:space_in*i+y_off},{x:width,y:space_in*i+y_off}]))},onSegment=function(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)},check_orientation=function(p,q,r){var val=(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);return 0==val?0:val>0?1:2},check_intersection=function(p1,q1,p2,q2){var o1=check_orientation(p1,q1,p2),o2=check_orientation(p1,q1,q2),o3=check_orientation(p2,q2,p1),o4=check_orientation(p2,q2,q1);return o1!=o2&&o3!=o4||(!(0!=o1||!onSegment(p1,p2,q1))||(!(0!=o2||!onSegment(p1,q2,q1))||(!(0!=o3||!onSegment(p2,p1,q2))||!(0!=o4||!onSegment(p2,q1,q2)))))},count_intersections=function(highlight=!1,index){div=document.getElementById("intersection_div"),num_intersections=0,tmp_links=window.graph.links.filter(l=>l.source!=window.graph.source&&l.target!=window.graph.sink);for(var i=0;i<tmp_links.length;i++)for(var link_i=tmp_links[i],a=0;a<link_i.anchors.length-1;a++)for(var p1=link_i.anchors[a],q1=link_i.anchors[a+1],j=i+1;j<tmp_links.length;j++)for(var link_j=tmp_links[j],b=0;b<link_j.anchors.length-1;b++){var p2=link_j.anchors[b],q2=link_j.anchors[b+1];1==check_intersection(p1,q1,p2,q2)&&(num_intersections++,highlight&&hightlight_intersection(p1,q1,p2,q2))}return div.innerHTML=num_intersections,num_intersections},hightlight_intersection=function(p1,q1,p2,q2){var lineGen=d3.line().x((function(d){return d.x})).y((function(d){return d.y}));svg.append("path").attr("stroke","red").attr("stroke-width","3").attr("d",lineGen([{x:p1.x,y:p1.y},{x:q1.x,y:q1.y}])),svg.append("path").attr("stroke","red").attr("stroke-width","3").attr("d",lineGen([{x:p2.x,y:p2.y},{x:q2.x,y:q2.y}]))},show_anchors=function(){if(0==showing_anchors){for(link of window.graph.links)for(anchor of link.anchors)svg.append("circle").attr("class","anchor-circle").attr("cx",anchor.x).attr("cy",anchor.y).attr("r",3).attr("fill","black");showing_anchors=!0}else svg.selectAll(".anchor-circle").remove(),showing_anchors=!1},count_bundled_edges=function(){div=document.getElementById("bundles_div"),num_bundles=0,div.innerHTML=num_bundles},swapArrayElements=function(arr,indexA,indexB){var temp=arr[indexA];arr[indexA]=arr[indexB],arr[indexB]=temp};