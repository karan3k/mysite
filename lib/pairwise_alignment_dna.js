function pairwiseAlignDna(sequences,opt){console.log(opt);var MATCH_SCORE=opt.MATCH_SCORE,MISMATCH_SCORE=opt.MISMATCH_SCORE,BEGIN_GAP_PENALTY=opt.BEGIN_GAP_PENALTY,GAP_PENALTY=opt.GAP_PENALTY,END_GAP_PENALTY=opt.END_GAP_PENALTY;for(final_seq="";sequences.length>1;)newDnaOne=sequences[0],newDnaTwo=sequences[1],-1!=newDnaOne.search(/./)&&(newDnaOne=newDnaOne.match(/./g)),-1!=newDnaTwo.search(/./)&&(newDnaTwo=newDnaTwo.match(/./g)),alignment=pairwiseDna(newDnaOne,newDnaTwo,MATCH_SCORE,MISMATCH_SCORE,GAP_PENALTY,BEGIN_GAP_PENALTY,END_GAP_PENALTY),sequences.shift(),sequences.shift(),sequences.push(merge_align(alignment));return sequences[0]}function merge_align(align){res="";for(var i=0;i<align.getAlignedM().length;i++)"-"!=align.getAlignedM()[i]?res+=align.getAlignedM()[i]:res+=align.getAlignedN()[i];return res}function is_valid_sequence(seq0,sequences){for(k in sequences)for(l1_i=0,seq1=sequences[k],i=l1_i;i<seq0.length;i++);return!0}function seq_align(sequences){var MATCH_SCORE=opt.MATCH_SCORE,MISMATCH_SCORE=opt.MISMATCH_SCORE,BEGIN_GAP_PENALTY=opt.BEGIN_GAP_PENALTY,GAP_PENALTY=opt.GAP_PENALTY,END_GAP_PENALTY=opt.END_GAP_PENALTY,best_score=-1e4;for(to_remove_i=null,to_remove_j=null,best_align=null,i=0;i<sequences.length;i++)for(j=i+1;j<sequences.length;j++)newDnaOne=sequences[i],newDnaTwo=sequences[j],-1!=newDnaOne.search(/./)&&(newDnaOne=newDnaOne.match(/./g)),-1!=newDnaTwo.search(/./)&&(newDnaTwo=newDnaTwo.match(/./g)),alignment=pairwiseDna(newDnaOne,newDnaTwo,MATCH_SCORE,MISMATCH_SCORE,GAP_PENALTY,BEGIN_GAP_PENALTY,END_GAP_PENALTY),alignment.score>=best_score&&(best_score=alignment.score,to_remove_i=sequences[i],to_remove_j=sequences[j],best_align=alignment);return{to_remove_i:to_remove_i,to_remove_j:to_remove_j,best_align:best_align}}function addReturns(sequence){return sequence=sequence.replace(/(.{60})/g,(function(str,p1,offset,s){return p1+"\n"}))}function pairwiseDna(newDnaOne,newDnaTwo,matchScore,mismatchScore,gapPenalty,beginGapPenalty,endGapPenalty){var useLinearSpace=!0,useQuadraticSpace=!1,matrix=new Identity;matrix.setMatch(matchScore),matrix.setMismatch(mismatchScore);var scoreSet=new ScoreSet,alignment;return scoreSet.setScoreSetParam(matrix,gapPenalty,beginGapPenalty,endGapPenalty),(alignment=new AlignPairLinear).setAlignParam(newDnaOne,newDnaTwo,scoreSet),alignment.align(),alignment}function getScore(r1,r2){return this.scoringMatrix.scoringMatrix_getScore(r1,r2)}function setScoreSetParam(scoringMatrix,gapPenalty,beginGapPenalty,endGapPenalty){this.scoringMatrix=scoringMatrix,this.gap=gapPenalty,this.beginGap=beginGapPenalty,this.endGap=endGapPenalty}function ScoreSet(){this.scoringMatrix,this.gap,this.beginGap,this.endGap,this.useBeginGapTop=!0,this.useBeginGapLeft=!0,this.useEndGapBottom=!0,this.useEndGapRight=!0}function scoringMatrix_getScore(r1,r2){return(r1=r1.toLowerCase())==(r2=r2.toLowerCase())?this.match:this.mismatch}function ScoringMatrix(){this.mismatch,this.match}function setMismatch(mismatchScore){this.mismatch=mismatchScore}function setMatch(matchScore){this.match=matchScore}function Identity(){}function align(){if(0==this.M.length)for(var j=1;j<=this.N.length;j++)this.alignedM.push("-"),this.alignedN.push(this.N[j-1]),this.score=this.score+this.scoreSet.gap;else if(0==this.N.length)for(var j=1;j<=this.M.length;j++)this.alignedN.push("-"),this.alignedM.push(this.M[j-1]),this.score=this.score+this.scoreSet.gap;else 0==this.M.length&&0==this.N.length||this.path(0,0,this.M.length,this.N.length)}function path(i1,j1,i2,j2){if(i1+1==i2||j1==j2){for(var subM=new Array,subN=new Array,i=i1+1;i<=i2;i++)subM.push(this.M[i-1]);for(var j=j1+1;j<=j2;j++)subN.push(this.N[j-1]);var alignment=new AlignPairQuad;subScoreSet=new ScoreSet,j1==j2?0==j1?subScoreSet.setScoreSetParam(this.scoreSet.scoringMatrix,this.scoreSet.beginGap,this.scoreSet.beginGap,this.scoreSet.beginGap):j1==this.N.length?subScoreSet.setScoreSetParam(this.scoreSet.scoringMatrix,this.scoreSet.endGap,this.scoreSet.endGap,this.scoreSet.endGap):subScoreSet.setScoreSetParam(this.scoreSet.scoringMatrix,this.scoreSet.gap,this.scoreSet.gap,this.scoreSet.gap):(subScoreSet.setScoreSetParam(this.scoreSet.scoringMatrix,this.scoreSet.gap,this.scoreSet.beginGap,this.scoreSet.endGap),subScoreSet.useBeginGapTop=!1,subScoreSet.useBeginGapLeft=!1,subScoreSet.useEndGapBottom=!1,subScoreSet.useEndGapRight=!1,0==i1&&(subScoreSet.useBeginGapTop=!0),0==j1&&(subScoreSet.useBeginGapLeft=!0),j2==this.N.length&&(subScoreSet.useEndGapRight=!0),i2==this.M.length&&(subScoreSet.useEndGapBottom=!0)),alignment.initializeMatrix(subM,subN,subScoreSet),alignment.fillMatrix(),alignment.align(),this.alignedM.push(alignment.getAlignedM()),this.alignedN.push(alignment.getAlignedN()),this.score=this.score+alignment.score}else{var middle=Math.floor((i1+i2)/2),diag,left,right;if(this.Sn[j1]=0,0==i1)for(var j=j1+1;j<=j2;j++)this.Sn[j]=this.Sn[j-1]-this.scoreSet.beginGap;else for(var j=j1+1;j<=j2;j++)this.Sn[j]=this.Sn[j-1]-this.scoreSet.gap;for(var i=i1+1;i<=middle;i++){diag=this.Sn[j1],left=0==j1?this.Sn[j1]-this.scoreSet.beginGap:this.Sn[j1]-this.scoreSet.gap,this.Sn[j1]=left;for(var j=j1+1;j<=j2;j++)left=j==this.N.length&&i==this.M.length?Math.max(this.Sn[j]-this.scoreSet.endGap,Math.max(left-this.scoreSet.endGap,diag+this.scoreSet.getScore(this.M[i-1],this.N[j-1]))):i==this.M.length?Math.max(this.Sn[j]-this.scoreSet.gap,Math.max(left-this.scoreSet.endGap,diag+this.scoreSet.getScore(this.M[i-1],this.N[j-1]))):j==this.N.length?Math.max(this.Sn[j]-this.scoreSet.endGap,Math.max(left-this.scoreSet.gap,diag+this.scoreSet.getScore(this.M[i-1],this.N[j-1]))):Math.max(this.Sn[j]-this.scoreSet.gap,Math.max(left-this.scoreSet.gap,diag+this.scoreSet.getScore(this.M[i-1],this.N[j-1]))),diag=this.Sn[j],this.Sn[j]=left}if(this.Sp[j2]=0,i2==this.M.length)for(var j=j2-1;j>=j1;j--)this.Sp[j]=this.Sp[j+1]-this.scoreSet.endGap;else for(var j=j2-1;j>=j1;j--)this.Sp[j]=this.Sp[j+1]-this.scoreSet.gap;for(var i=i2-1;i>=middle;i--){diag=this.Sp[j2],right=j2==this.N.length?this.Sp[j2]-this.scoreSet.endGap:this.Sp[j2]-this.scoreSet.gap,this.Sp[j2]=right;for(var j=j2-1;j>=j1;j--)right=0==j&&0==i?Math.max(this.Sp[j]-this.scoreSet.beginGap,Math.max(right-this.scoreSet.beginGap,diag+this.scoreSet.getScore(this.M[i+1-1],this.N[j+1-1]))):0==j?Math.max(this.Sp[j]-this.scoreSet.beginGap,Math.max(right-this.scoreSet.gap,diag+this.scoreSet.getScore(this.M[i+1-1],this.N[j+1-1]))):0==i?Math.max(this.Sp[j]-this.scoreSet.gap,Math.max(right-this.scoreSet.beginGap,diag+this.scoreSet.getScore(this.M[i+1-1],this.N[j+1-1]))):Math.max(this.Sp[j]-this.scoreSet.gap,Math.max(right-this.scoreSet.gap,diag+this.scoreSet.getScore(this.M[i+1-1],this.N[j+1-1]))),diag=this.Sp[j],this.Sp[j]=right}for(var maxValue=this.Sn[j1]+this.Sp[j1],maxJ=j1,j=j1+1;j<=j2;j++)this.Sn[j]+this.Sp[j]>=maxValue&&(maxValue=this.Sn[j]+this.Sp[j],maxJ=j);this.path(i1,j1,middle,maxJ),this.path(middle,maxJ,i2,j2)}}function getAlignedM(){return this.alignedM.join("")}function getAlignedN(){return this.alignedN.join("")}function setAlignParam(M,N,scoreSet){this.M=M,this.N=N,this.alignedM=new Array,this.alignedN=new Array,this.scoreSet=scoreSet,this.Sn=new Array(this.N.length),this.Sp=new Array(this.N.length),this.score=0}function AlignPairLinear(){this.M,this.N,this.alignedM,this.alignedN,this.scoreSet,this.Sn,this.Sp,this.score}new ScoreSet,ScoreSet.prototype.getScore=getScore,ScoreSet.prototype.setScoreSetParam=setScoreSetParam,new ScoringMatrix,ScoringMatrix.prototype.scoringMatrix_getScore=scoringMatrix_getScore,Identity.prototype=new ScoringMatrix,Identity.prototype.setMismatch=setMismatch,Identity.prototype.setMatch=setMatch,new AlignPairLinear,AlignPairLinear.prototype.align=align,AlignPairLinear.prototype.path=path,AlignPairLinear.prototype.setAlignParam=setAlignParam,AlignPairLinear.prototype.getAlignedM=getAlignedM,AlignPairLinear.prototype.getAlignedN=getAlignedN;